
## Code structure

### Shopify Workflow
1. `/giftbasket/login` will take you to the installation page of the Shopify app
2. After you enter your shop address, you will be redirected to `/giftbasket/install`, which will construct the `install_url` and direct you there
3. `install_url` will show you a prompt to grant permissions to install the app to your shop, you need to login as a shop admin
4. After you click the install button, you will be redirected to `/giftbasket/auth`, which will perform hmac validation and generate an access token
5. You will be redirected to `/giftbasket/test` upon successful token genereation - I wrote an example in there to show you how to create a customer with an email address

### Tuya Workflow 

Please see `/tuya`

Tuya adapts OAuth2 and uses a 2-step MD5 hash algorithm to generate an access token. 

You can find more details on the documentation here: 
https://docs.tuya.com/en/openapi/simple_grant_type.html 

In `/tuya` I provided an example of how to generate an access token and get a list of user IDs using the API from the `Novolink` app. 

Note that you also need to refresh the token periodically. 


## Requirements

* [Ruby](https://www.ruby-lang.org/en/documentation/installation/) (sample apps were written with Ruby 2.2.1)
* [Bundler for Ruby](http://bundler.io/), a dependency manager
* [Shopify Partners account](https://accounts.shopify.com/signup)

## Credentials

Follow [this guide](https://help.shopify.com/api/getting-started/api-credentials) to obtain your public app credentials from your Shopify Partners account.

This example app uses a `.env` file to store app credentials. After cloning the repository, create a `.env` file in the root folder (`/tuya-importer`) using the code snippet below. Then, copy the values of the _API Key_ and _API Secret_ from your partner dashboard, and use them as the values in `.env`.

```bash
SHOPIFY_API_KEY=YOUR_API_KEY
SHOPIFY_API_SECRET=YOUR_SECRET_KEY
APP_URL=YOUR_APP_URL
...
```

`YOUR_API_KEY` and `YOUR_SECRET_KEY` are the values you must replace.

## App URL

This app series uses [ngrok](https://ngrok.com/) to create a secure tunnel from the internet to your local machine. For each installment in the series, you will need to copy the `APP_URL` generated by ngrok to your `.env` file.  Additionally, the `APP_URL` needs to be added to the **App URLs** section of your public app settings. These procedures are covered in the [Building a public Shopify application](https://help.shopify.com/api/tutorials/building-public-app) tutorial.

## Running the app

```ruby
bundle install
ruby app/app.rb
```
